@using Archetype.Extensions
@using Archetype.Models
@using Umbraco.Core.Models
@using RJP.MultiUrlPicker.Models
@using Umbraco.Core.Persistence
@using USDA_ARS.Umbraco.Extensions.Models.Aris
@using USDA_ARS.Umbraco.Extensions.Helpers
@using USDA_ARS.Umbraco.Extensions.Helpers.Aris
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
    Layout = "_Master.cshtml";

    IPublishedContent currentPage = Model.Content;
    IPublishedContent rootPage = currentPage.AncestorOrSelf(1);

    IPublishedContent programsAndProjects = Nodes.ProgramsAndProjects();
    IPublishedContent newsNode = Nodes.NewsAndEvents();
    IPublishedContent publicationsAtThisLocation = Nodes.PublicationsAtThisLocation();

    string modeCode = currentPage.GetPropertyValue<string>("modeCode");
    string defaultCarouselImage = rootPage.GetPropertyValue<string>("defaultCarouselImage");

    ArchetypeModel defaultPopularTopics = rootPage.GetPropertyValue<ArchetypeModel>("popularTopics");

    IEnumerable<IPublishedContent> softwareDownloads = Software.GetSofwareListByNode(currentPage);

    ArchetypeModel popularTopics = currentPage.GetPropertyValue<ArchetypeModel>("popularTopics");
    ArchetypeModel carouselSlides = currentPage.GetPropertyValue<ArchetypeModel>("carouselSlides");

    List<UsdaProject> researchList = USDA_ARS.Umbraco.Extensions.Helpers.Aris.Projects.ListProjects(modeCode, 3);

    List<IPublishedContent> newsList = News.GetNewsManuallySelected(currentPage);
    List<IPublishedContent> newsInterLinksList = NewsInterLinks.GetNewsByModeCode(modeCode);

    if (newsInterLinksList != null && newsInterLinksList.Any())
    {
        newsList.AddRange(newsInterLinksList);
    }

    if (newsList != null && newsList.Any())
    {
        newsList = newsList.OrderByDescending(p => p.GetPropertyValue<DateTime>("articleDate")).ToList();
        newsList = newsList.Take(5).ToList();
    }

    List<UsdaPublication> publicationList = USDA_ARS.Umbraco.Extensions.Helpers.Aris.Publications.ListPublications(modeCode, 3);

    string rightArea = currentPage.GetPropertyValue<string>("quickLinks");

    if (true == string.IsNullOrWhiteSpace(rightArea))
    {
        List<PeopleInfo> peopleList = USDA_ARS.Umbraco.Extensions.Helpers.Aris.People.GetPeople(modeCode);

        rightArea = "<h1>People</h1>\r\n";
        if (peopleList != null && peopleList.Count > 0)
        {
            rightArea += "<ul>\r\n";
            foreach (PeopleInfo person in peopleList)
            {
                rightArea += "<li><a href=\"/people-locations/person/?person-id=" + person.PersonId + "\">";
                rightArea += person.LastName + ", " + person.FirstName;
                if (false == string.IsNullOrEmpty(person.CommonName))
                {
                    rightArea += " - <em>"+ person.CommonName +"</em>";
                }
                rightArea += "</a></li>\r\n";
            }
            rightArea += "</ul>\r\n";
        }
    }

    USDA_ARS.Umbraco.Extensions.Helpers.Aris.SiteInfo siteInfo = new USDA_ARS.Umbraco.Extensions.Helpers.Aris.SiteInfo(modeCode);

    string missionStatement = "";
    string adminDetails = "";

    if (siteInfo != null)
    {
        missionStatement = siteInfo.MissionStatement;
        adminDetails = siteInfo.AdminDetails;
    }
}
<div id="bodyContent">




    <!-- top content -->
    <div id="topContent">
        <div id="TopicsTips">
            <!-- right top content -->

            <div id="popularTopics">
                <a name="popular" class="section508">Popular Topics Content</a>
                <h1>@currentPage.Name</h1>

                @if (defaultPopularTopics != null && defaultPopularTopics.Any())
                {
                    <ul>
                        @foreach (var topic in defaultPopularTopics)
                        {
                            bool showTopic = true;

                            if (topic.GetValue("label") == "Software")
                            {
                                if (softwareDownloads == null || softwareDownloads.Count() <= 0)
                                {
                                    showTopic = false;
                                }
                            }

                            if (true == showTopic)
                            {
                                string navLinkUrl = "#";
                                if (topic.HasValue("link"))
                                {
                                    Link navLink = topic.GetValue<MultiUrls>("link").FirstOrDefault();

                                    if (navLink != null)
                                    {
                                        navLinkUrl = navLink.Url;
                                    }
                                }
                            <li>
                                <a href="@(navLinkUrl + "?modeCode=" + modeCode)">@Html.Raw(topic.GetValue("label"))</a>
                            </li>
                            }
                        }

                        @if (popularTopics != null && popularTopics.Any())
                        {
                            <div id="popularLinksMoreMenu" style="z-index: 1; position: relative">
                                <li>
                                    <a href="#" class="more" title="See more of popular topics">More</a>
                                    <ul>
                                        @foreach (var topic in popularTopics)
                                        {
                                            string navLinkUrl = "#";
                                            if (topic.HasValue("link"))
                                            {
                                                Link navLink = topic.GetValue<MultiUrls>("link").FirstOrDefault();

                                                if (navLink != null)
                                                {
                                                    navLinkUrl = navLink.Url;
                                                }
                                            }
                                            <li>
                                                <a href="@(navLinkUrl + "?modeCode=" + modeCode)">@Html.Raw(topic.GetValue("label"))</a>
                                            </li>
                                        }
                                    </ul>
                                </li>
                            </div>
                        }
                    </ul>
                }

                <a href="top" class="section508">Back to Top of Page</a>
            </div>	<!-- popular topcis -->
            <!-- Stay Connected -->
            <div id="socialmedia">
                <a name="social" class="section508">Social Media Links </a>

                <h2>Stay Connected:</h2>
                @Html.Partial("~/Views/Partials/Modules/SocialLinks.cshtml")

                <!-- sign up email box -->
                @Html.Action("Index", "EmailSignupSiteSurface")

                <a href="top" class="section508">Back to Top of Page</a>
            </div>	<!-- Stay Connected -->
        </div>	<!-- right top content -->
        
        @Html.Partial("~/Views/Partials/Modules/PhotoCarousel.cshtml", currentPage)

    </div>	<!-- top content end -->
    <!-- middle content -->
    <!--[if lt IE 9]>
        <div style="position: relative; bottom:-33px; z-index:1000;">
            <img src="/images/redesign/rounded-top.png" alt="spacer">
        </div>
    <![endif]-->

    <div id="middleContent">
        <!-- middle left (tabs) -->
        <div id="middleLeft">

            <div id="middleTabs">


                <ul style="border: 0px; margin:-4px;">
                    <li style="border-top-left-radius: 23px; margin:0px; text-align: center; width:98px; height:36px;">
                        <a href="#tab1" style="margin-top: 3px; margin-left: 10px;">Research</a>
                    </li>
                    <li style="margin:0px; width:100px; height:36px;">
                        <a href="#tab2" style="margin-top: 3px; margin-left: 20px;">News</a>
                    </li>
                    <li style="margin:0px; width:100px; height:36px;">
                        <a href="#tab3" style="margin-top: 3px;">Publications</a>
                    </li>
                </ul>

                <div id="tab1">
                    <ul>

                        @if (researchList != null && researchList.Any())
                        {
                            foreach (UsdaProject item in researchList)
                            {
                            <li>
                                <a href="@(programsAndProjects.Url)project/?accnNo=@item.AccountNo">
                                    @item.Title
                                </a>
                            </li>
                            }
                        }

                        <li class="textAlignRight">
                            <a href="@(programsAndProjects.Url)?modecode=@modeCode">&gt;&gt;&gt;More</a>
                        </li>

                    </ul>
                </div>


                <div id="tab2">
                    <ul>
                        @if (newsList != null && newsList.Any())
                        {
                            foreach (IPublishedContent item in newsList)
                            {
                            <li>
                                <a href="@item.Url">
                                    @(item.Name)
                                </a>
                            </li>
                            }
                        }

                        <li class="textAlignRight">
                            <a href="@(newsNode.Url)?modecode=@modeCode">&gt;&gt;&gt;More</a>
                        </li>
                    </ul>
                </div>


                <div id="tab3">
                    <ul>
                        @if (publicationList != null && publicationList.Any())
                        {
                            foreach (UsdaPublication item in publicationList)
                            {
                            <li>
                                <a href="@(publicationsAtThisLocation.Url)publication/?seqNo115=@item.SeqNo115">
                                    @item.Title
                                </a>
                            </li>
                            }
                        }

                        <li class="textAlignRight">
                            <a href="@(publicationsAtThisLocation.Url)?modecode=@modeCode">&gt;&gt;&gt;More</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>



        <div id="middleCenter">

            <font size="2">
                <table border="0" cellpadding="0" cellspacing="0" width="100%" summary="This table displays information about this location">
                    <tbody>
                        <tr>
                            <td>
                                @Html.Raw(adminDetails)
                                <p>
                                    <!-- MapQuest info here.  query_string= modecode=@(modeCode) -->
                                </p>

                                <p>
                                    <strong>Mission:</strong><br>
                                    @missionStatement
                                </p>
                                <p></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </font>

        </div>



        <div id="middleRight">

            @Html.Raw(rightArea)

        </div>

        <!--[if lt IE 9]>
            <div style="position: relative; top: -10px; z-index:1000;" >
                <img src="/images/redesign/rounded-bottom.png" alt="spacer">
            </div>
        <![endif]-->
    </div>
    <!-- middle content end -->
    <!-- bottom content -->
    <!--[if lt IE 9]>


        <div style="position: relative; bottom:-33px; z-index:1000;">
            <img src="/images/redesign/rounded-top.png" alt="spacer">
        </div>
    <![endif]-->
    <div id="bottomContent">
        <a name="areas" href="top" class="section508">Research Areas & Locations Content | Click to go Back to Top</a>

        <div id="tabs">
            <ul>
                <li>
                    <a href="#keyOfficeTab">Key ARS Offices and Locations</a>
                </li>
                <li>
                    <a href="#areaLocationTab">
                        @currentPage.Name Locations

                    </a>
                </li>
            </ul>

            <div id="keyOfficeTab">
                <a name="areas" href="top" class="section508">Research Areas & Locations Content | Click to go Back to Top</a>

                <!-- bottom content left -->
                <div id="bottomContentLeft">
                    @Html.Partial("~/Views/Partials/Modules/MainOfficeList.cshtml")
                </div>


                <!-- bottom content right -->


                <div id="bottomContentRight">
                    @Html.Partial("~/Views/Partials/Modules/ResearchLocationsList.cshtml")
                </div>

            </div>

            <div id="areaLocationTab">
                @Html.Partial("~/Views/Partials/Modules/RegionLocationsList.cshtml", currentPage)
            </div>
        </div>


    </div>
    <!-- bottom content end -->

</div>