@using System.Text.RegularExpressions
@using Umbraco.Core.Models
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
    Layout = "_Master.cshtml";

    IPublishedContent currentPage = Model.Content;
    IEnumerable<IPublishedContent> eventsList = currentPage.Parent.Children.OrderByDescending(p => p.GetProperty("eventDate").Value);
    bool archiveEvents = false;

    if (false == string.IsNullOrEmpty(Request.QueryString["archived"]))
    {
        archiveEvents = Request.QueryString.Get("archived") == "1" ? true : false;
    }

    eventsList = eventsList.Where(p => p.GetPropertyValue<bool>("archiveEvent") == archiveEvents);

    string description = currentPage.GetPropertyValue<string>("description");

    if (false == string.IsNullOrWhiteSpace(description))
    {
        description = Regex.Replace(description, "<[/]*p>", "");
    }
}

@Html.Partial("~/Views/Partials/Modules/NavigationLinksSub.cshtml", currentPage)

<div id="fullPage">

    @Html.Partial("~/Views/Partials/Modules/RelatedTopicsList.cshtml", currentPage)

    <div id="pageContent">

        <div style="border-bottom:1 solid; border-top:1 solid; border-left:1 solid; border-right: 1 solid; padding-left:10; padding-top:10px;">
            <strong>Event:</strong>
            @(currentPage.Name)<div class="spEvent">&nbsp;</div><!--EV:evid:770-->
            <br />
            <table align="right" style="z-index: 300;">
                <tbody>
                    <tr>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <br />
            <strong>Date:</strong>
            @(currentPage.GetPropertyValue<DateTime>("eventDate").ToLongDateString())
            <p>
                <strong>Description</strong>:
                @Html.Raw(description)
            </p>
            <p>
                <strong>Contact Info</strong> :
                @Html.Raw(currentPage.GetPropertyValue<string>("contactInfo"))
            </p>
            <p>

            </p>
        </div>


        <table cellspacing="0" cellpadding="3">
            <tbody>
                <tr>
                    <td class="hdrBlackBold">ARS Events</td>
                </tr>
                <tr>
                    <td><a href="/news-events/events/?archived=1" id="anch_76">Archived Events</a></td>
                    <td>|</td>
                    <td><a href="/news-events/events/?" id="anch_77">Upcoming Events</a></td>
                </tr>
            </tbody>
        </table>
        <table cellspacing="0" cellpadding="3">
            <tbody>
                <tr>
                    <td><img src="/ARSUserFiles/incme/images/dividerline.gif" width="368"></td>
                </tr>
            </tbody>
        </table>
        <table cellspacing="0" cellpadding="3">

            <tbody>
                <tr>
                    <td class="hdrBlackBold">@(false == archiveEvents ? "Upcoming Events" : "Archived Events")</td>
                </tr>

                @if (eventsList != null && eventsList.Any())
                {
                    foreach (IPublishedContent node in eventsList)
                    {
                    <tr>
                        <td class="bodyTextBlackSmall"><a href="@node.Url" class="projectNav" id="anch_78">@node.Name</a> (@(node.GetPropertyValue<DateTime>("eventDate").ToString("MM/dd/yy")))</td>
                    </tr>
                    <tr>
                        <td><img src="/images/content-divider.gif" width="368" height="10"></td>
                    </tr>
                    }
                }


            </tbody>
        </table>


    </div>


</div>