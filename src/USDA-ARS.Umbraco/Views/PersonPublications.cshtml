@using Archetype.Extensions
@using Archetype.Models
@using Umbraco.Core.Models
@using RJP.MultiUrlPicker.Models
@using USDA_ARS.Umbraco.Extensions.Utilities
@using USDA_ARS.Umbraco.Extensions.Helpers.Aris
@using USDA_ARS.Umbraco.Extensions.Models.Aris
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
   Layout = "_Master.cshtml";

   IPublishedContent currentPage = Model.Content;

   PeopleInfo peopleInfo = null;
   List<PeoplePublication> peoplePublicationList = null;

   if (false == string.IsNullOrEmpty(Request.QueryString["person-id"]))
   {
      int personId = Convert.ToInt32(Request.QueryString["person-id"]);

      IPublishedContent personSite = USDA_ARS.Umbraco.Extensions.Helpers.Nodes.GetNodeByPersonId(personId);

      if (null == personSite)
      {
         peopleInfo = People.GetPerson(personId);

         if (peopleInfo != null)
         {
            peoplePublicationList = Publications.PublicationsByPerson(personId);
         }
      }
      else
      {
         Response.Redirect(personSite.Url);
      }
   }

}

@Html.Partial("~/Views/Partials/Modules/NavigationLinksSub.cshtml", currentPage)

<div id="fullPage">

   @Html.Partial("~/Views/Partials/Modules/RelatedTopicsList.cshtml", currentPage)

   <div id="pageContent">

      <script language="javascript">
<!--
window.name = 'nps2000';
var remote = null;
function rs(n,u,w,h) {
remote = window.open(u, n, 'width=' + w + ',height=' + h +',refresh=yes,resizable=yes,scrollbars=yes');
if (remote != null) {
if (remote.opener == null)
remote.opener = self;
window.name = 'nps2000';
remote.location.href = u;
}
}
//-->
      </script>


      @if (peopleInfo != null)
      {

         <table width="100%" border="0">
            <tbody>
               <tr>
                  <td valign="top">
                     <b>
                        @peopleInfo.FirstName @peopleInfo.MiddleName @peopleInfo.LastName

                        @if (false == string.IsNullOrEmpty(peopleInfo.CommonName))
                        {
                           @("(" + peopleInfo.CommonName + ")")
                        }
                     </b>
                     <br />

                     @(peopleInfo.TitleWorking)

                     <script language="JavaScript">function DisplayEmail(username, domain) { document.write(username + "&#64;" + domain); }</script>
                     <br />

                     <a href="mailto:@(peopleInfo.Email)?Subject=From ARS website">
                        @if (peopleInfo.Email != null && peopleInfo.Email.Split('@').Length == 2)
                        {
                           <script language="javascript">DisplayEmail('@(peopleInfo.Email.Split('@')[0])', '@(peopleInfo.Email.Split('@')[1])');</script>
                        }
                     </a><br />

                     <p> </p>


                     @if (peoplePublicationList != null && peoplePublicationList.Any())
                     {
                        <br />

                        <table width="368">
                           <tbody>
                              <tr>
                                 <td>
                                    <strong>Publications</strong>
                                    <font size="-2">
                                       (Clicking on the reprint icon
                                       <img src="/images/reprintURLIcon.gif" alt="Reprint Icon" border="0">
                                       will take you to the publication reprint.)
                                    </font>
                                 </td>
                              </tr>

                              <tr>
                                 <td><img src="/images/headline_bar.gif"></td>
                              </tr>

                              @foreach (PeoplePublication peoplePub in peoplePublicationList)
                              {
                                 <tr>
                                    <td class="bodyTextBlack">
                                       <a href="/research/publications/publication/?seqNo115=@(peoplePub.SeqNo115)" class="projectNav" id="anch_60">@(peoplePub.Title)</a>

                                       @if (false == string.IsNullOrWhiteSpace(peoplePub.ReprintUrl))
                                       {
                                          <a href="http://@(peoplePub.ReprintUrl)" target="_blank" title="Reprint URL" id="anch_65">
                                             <img src="/images/reprintURLIcon.gif" alt="Reprint Icon" border="0">
                                          </a>
                                       }
                                       -
                                       @{
                                          string publicationType = "";

                                          if (peoplePub.PubTypeCode == "J")
                                          {
                                             publicationType = "Peer Reviewed Journal";
                                          }
                                          else if (peoplePub.PubTypeCode == "A")
                                          {
                                             publicationType = "Abstract Only";
                                          }
                                          else if (peoplePub.PubTypeCode == "P")
                                          {
                                             publicationType = "Proceedings";
                                          }

                                          Html.Raw("(" + publicationType + ")");
                                       }
                                    </td>
                                 </tr>
                                 <tr>
                                    <td style="padding-left:10px;" class="bodyTextBlack">
                                       @(peoplePub.Citation)
                                    </td>
                                 </tr>

                                 <tr>
                                    <td><img src="/images/content-divider.gif"></td>
                                 </tr>
                                          }

                           </tbody>
                        </table>
                                          }


                  </td>
               </tr>
            </tbody>
         </table>

                                          }
                                          else
                                          {
         <strong><em>The person you selected is invalid or no longer available.</em></strong>
                                          }

   </div>

</div>