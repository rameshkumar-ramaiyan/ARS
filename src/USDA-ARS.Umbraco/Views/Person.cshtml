@using Archetype.Extensions
@using Archetype.Models
@using Umbraco.Core.Models
@using RJP.MultiUrlPicker.Models
@using USDA_ARS.Umbraco.Extensions.Models.Aris
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@{
    Layout = "_Master.cshtml";

    IPublishedContent currentPage = Model.Content;

    PeopleInfo peopleInfo = null;
    List<PeoplePublication> peoplePublicationList = null;


    if (false == string.IsNullOrEmpty(Request.QueryString["person-id"]))
    {
        int personId = Convert.ToInt32(Request.QueryString["person-id"]);

        IPublishedContent personSite = USDA_ARS.Umbraco.Extensions.Helpers.Nodes.GetNodeByPersonId(personId);

        if (null == personSite)
        {
            peopleInfo = USDA_ARS.Umbraco.Extensions.Helpers.Aris.People.GetPerson(personId);

            peoplePublicationList = USDA_ARS.Umbraco.Extensions.Helpers.Aris.Publications.PublicationsByPerson(personId);
        }
        else
        {
            Response.Redirect(personSite.Url);
        }
    }
    if (peopleInfo == null)
    {
        Response.Redirect(currentPage.Parent.Url);
    }

}

@Html.Partial("~/Views/Partials/Modules/NavigationLinksSub.cshtml", currentPage)

<div id="fullPage">

    @Html.Partial("~/Views/Partials/Modules/RelatedTopicsList.cshtml", currentPage)

    <div id="pageContent">




        <script language="javascript">
<!--
window.name = 'nps2000';
var remote = null;
function rs(n,u,w,h) {
remote = window.open(u, n, 'width=' + w + ',height=' + h +',refresh=yes,resizable=yes,scrollbars=yes');
if (remote != null) {
if (remote.opener == null)
remote.opener = self;
window.name = 'nps2000';
remote.location.href = u;
}
}
//-->
        </script>







        <table width="100%" border="0">
            <tbody>
                <tr>
                    <td valign="top">

                        @peopleInfo.FirstName @peopleInfo.MiddleName @peopleInfo.LastName

                        @if (false == string.IsNullOrEmpty(peopleInfo.CommonName))
                        {
                            @("(" + peopleInfo.CommonName + ")")
                        }
                        <br/ >

                        <font size="-1">
                            <!-- Get this and parent Modecodes-->
                            <a href="/main/site_main.htm?modecode=20-00-00-00" id="anch_48"> </a>

                            <a href="/main/site_main.htm?modecode=20-50-00-00" id="anch_49"> </a>

                            @{
                                string modeCode = peopleInfo.ModeCode1 + "-" + peopleInfo.ModeCode2.ToString("00") + "-" + peopleInfo.ModeCode3.ToString("00") + "-" + peopleInfo.ModeCode4.ToString("00");
                                IPublishedContent node = USDA_ARS.Umbraco.Extensions.Helpers.Nodes.GetNodeByModeCode(modeCode);

                                if (node != null)
                                {
                                    <a href="@node.Url" id="anch_50"> @node.Name </a>
                                }
                            }

                        </font>

                        <script language="JavaScript">function DisplayEmail(username, domain) { document.write(username + "&#64;" + domain); }</script>
                        <br>

                        @(peopleInfo.TitleWorking)<br />

                        <a href="/contactus/feedback.htm?email=5D46F58CD165A3D77A5CB97E9EAEBC1D8061AAF2F983A240" id="anch_51">
                            @if (peopleInfo.Email != null && peopleInfo.Email.Split('@').Length == 2)
                            {
                                <script language="javascript">DisplayEmail('@(peopleInfo.Email.Split('@')[0])', '@(peopleInfo.Email.Split('@')[1])');</script>
                            }
                        </a><br>


                        Phone: @("(" + peopleInfo.PhoneAreaCode + ")") @peopleInfo.Phone <br />

                        Fax: <strong>TODO</strong><br />
                        <br />
                        @peopleInfo.Address1<br />
                        @Html.Raw(false == string.IsNullOrWhiteSpace(peopleInfo.Address2) ? peopleInfo.Address2 + "<br />" : "")
                        @peopleInfo.City, @peopleInfo.State @peopleInfo.PostalCode<br />


                        <p> </p>

                        @if (peoplePublicationList != null && peoplePublicationList.Any())
                        {
                            <br />

                            <table width="368">
                                <tbody>
                                    <tr>
                                        <td>
                                            <strong>Publications</strong>
                                            <font size="-2">
                                                (Clicking on the reprint icon
                                                <img src="/images/reprintURLIcon.gif" alt="Reprint Icon" border="0">
                                                will take you to the publication reprint.)
                                            </font>
                                        </td>
                                    </tr>

                                    <tr>
                                        <td><img src="/images/headline_bar.gif"></td>
                                    </tr>

                                    @foreach (PeoplePublication peoplePub in peoplePublicationList)
                                    {
                                        <tr>
                                            <td class="bodyTextBlack">
                                                <a href="/research/publications/publication/?SEQ_NO_115=@(peoplePub.SeqNo115)" class="projectNav" id="anch_60">@(peoplePub.Title)</a>

                                                @if (false == string.IsNullOrWhiteSpace(peoplePub.ReprintUrl))
                                                {
                                                    <a href="http://@(peoplePub.ReprintUrl)" target="_blank" title="Reprint URL" id="anch_65">
                                                        <img src="/images/reprintURLIcon.gif" alt="Reprint Icon" border="0">
                                                    </a>
                                                }
                                                -
                                                @{
                                                    string publicationType = "";

                                                    if (peoplePub.PubTypeCode == "J")
                                                    {
                                                        publicationType = "Peer Reviewed Journal";
                                                    }
                                                    else if (peoplePub.PubTypeCode == "A")
                                                    {
                                                        publicationType = "Abstract Only";
                                                    }
                                                    else if (peoplePub.PubTypeCode == "P")
                                                    {
                                                        publicationType = "Proceedings";
                                                    }

                                                    Html.Raw("(" + publicationType + ")");
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding-left:10px;" class="bodyTextBlack">
                                                @(peoplePub.Citation)
                                            </td>
                                        </tr>

                                        <tr>
                                            <td><img src="/images/content-divider.gif"></td>
                                        </tr>
                                                    }

                                </tbody>
                            </table>
                                                    }


                    </td>
                    <td valign="top">


                        @*<font face="verdana,arial" size="-2" color="#014c3e">
                                    <b>

                                        ARS News Articles
                                        <font face="verdana,arial" size="-2" color="#014c3e">
                                        </font>
                                    </b><font face="verdana,arial" size="-2" color="#014c3e">
                                    </font>
                                    <br>

                                    <font face="verdana,arial" size="-2">
                                        <div align="left">
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td valign="top"><img src="/incme/images/bullet.gif" border="0" alt="item"></td>
                                                        <td valign="top" align="left" background="/incme/images/spacer.gif">
                                                            <font face="verdana,arial" size="-1">
                                                                <a href="/is/pr/2007/071127.htm" id="anch_115">Village Wheats May Fend Off Stem Rust</a>
                                                            </font>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td valign="top"><img src="/incme/images/bullet.gif" border="0" alt="item"></td>
                                                        <td valign="top" align="left" background="/incme/images/spacer.gif">
                                                            <font face="verdana,arial" size="-1">
                                                                <a href="/is/pr/2011/111024.htm" id="anch_116">Stem Rust-resistant Wheat Landraces Identified</a>
                                                            </font>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                    </div>
                                </font>

                            </font>*@
                    </td>

                </tr>
            </tbody>
        </table>

    </div>

</div>